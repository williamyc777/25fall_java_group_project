<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - NYU Activity Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f5f5f7;
        }
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 0;
            color: white;
        }
        .avatar-large {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            object-fit: cover;
            border: 5px solid white;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand fw-semibold" href="/main">NYU Activity Center</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#profileNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="profileNavbar">
                <div class="navbar-nav ms-auto align-items-lg-center gap-lg-1">
                    <a class="nav-link" href="/main">Events</a>
                    <a class="nav-link" href="/square">Posts</a>
                    <a class="nav-link" href="/message">Messages</a>
                    <a class="nav-link" th:if="${isAdmin}" href="/admin">Admin</a>
                    <a class="nav-link active" th:if="${user}" th:href="@{/profile(userID=${user.id})}">Profile</a>
                    <a class="nav-link" th:if="${user == null}" href="/">Login</a>
                    <button class="btn btn-sm btn-outline-light ms-lg-2" type="button"
                            onclick="logout()" th:if="${user}">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="profile-header">
        <div class="container text-center">
            <img id="userAvatar" 
                 th:src="${user != null and user.avatar != null and user.avatar != '' ? user.avatar : 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cmVjdCBmaWxsPSIjZGRkIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIvPjx0ZXh0IGZpbGw9IiM5OTkiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBkeT0iMTAuNSIgZm9udC13ZWlnaHQ9ImJvbGQiIHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7ovazovb08L3RleHQ+PC9zdmc+'}" 
                 class="avatar-large mb-3" 
                 alt="Avatar"
                 onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cmVjdCBmaWxsPSIjZGRkIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIvPjx0ZXh0IGZpbGw9IiM5OTkiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBkeT0iMTAuNSIgZm9udC13ZWlnaHQ9ImJvbGQiIHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7ovazovb08L3RleHQ+PC9zdmc+';">
            <h2 th:text="${user != null ? user.name : 'User'}">Username</h2>
            <p th:text="${user != null ? '@' + user.username : ''}">@username</p>
            <p th:text="${user != null ? user.bio : ''}">Bio</p>
        </div>
    </div>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <button class="btn btn-primary mb-2" onclick="editProfile()">Edit Profile</button>
                        <button class="btn btn-secondary mb-2" onclick="changeAvatar()">Change Avatar</button>
                        <button class="btn btn-danger" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
            <div class="col-md-9">
                <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts">My Posts</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events">My Events</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="fav-events-tab" data-bs-toggle="tab" data-bs-target="#fav-events">Favorite Events</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="fav-posts-tab" data-bs-toggle="tab" data-bs-target="#fav-posts">Favorite Posts</button>
                    </li>
                </ul>
                <div class="tab-content mt-3" id="profileTabContent">
                    <div class="tab-pane fade show active" id="posts">
                        <div id="userPosts">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="events">
                        <div id="userEvents">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="fav-events">
                        <div id="favoriteEvents">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="fav-posts">
                        <div id="favoritePosts">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" id="editName" name="name">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Bio</label>
                            <textarea class="form-control" id="editBio" name="bio" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProfile()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // È°µÈù¢Âä†ËΩΩÊó∂Ôºå‰∏∫Â§¥ÂÉèÊ∑ªÂä†Êó∂Èó¥Êà≥ÈÅøÂÖçÁºìÂ≠ò
        window.addEventListener('DOMContentLoaded', function() {
            const avatarImg = document.getElementById('userAvatar');
            if (avatarImg && avatarImg.src) {
                const timestamp = new Date().getTime();
                const currentSrc = avatarImg.src;
                if (!currentSrc.includes('?t=')) {
                    avatarImg.src = currentSrc + (currentSrc.includes('?') ? '&' : '?') + 't=' + timestamp;
                }
            }
        });

        function getToken() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'token') {
                    return value;
                }
            }
            return null;
        }

        async function editProfile() {
            const token = getToken();
            if (!token) {
                alert('Please login first');
                return;
            }
            // Âä†ËΩΩÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
            try {
                const response = await fetch('/userInfo', {
                    headers: { 'Authorization': token }
                });
                const responseText = await response.text();
                const data = JSON.parse(responseText);
                const user = data.data || data;
                document.getElementById('editName').value = user.name || '';
                document.getElementById('editBio').value = user.bio || '';
                new bootstrap.Modal(document.getElementById('editModal')).show();
            } catch (error) {
                console.error('Failed to load user info:', error);
                alert('Failed to load user info');
            }
        }

        async function saveProfile() {
            const token = getToken();
            if (!token) {
                alert('Please login first');
                return;
            }
            
            const formData = new FormData();
            formData.append('name', document.getElementById('editName').value);
            formData.append('bio', document.getElementById('editBio').value);

            try {
                const response = await fetch('/profile/info/edit', {
                    method: 'POST',
                    headers: { 'Authorization': token },
                    body: formData
                });
                
                if (response.ok) {
                    const responseText = await response.text();
                    try {
                        const result = JSON.parse(responseText);
                        // ÂìçÂ∫îÊ†ºÂºè: {"code":0,"msg":"success","data":true}
                        const success = result.data !== undefined ? result.data : result;
                        if (success) {
                            alert('Saved successfully');
                            bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                            location.reload();
                        } else {
                            alert('Save failed');
                        }
                    } catch (e) {
                        // Â¶ÇÊûú‰∏çÊòØJSONÔºåÂèØËÉΩÊòØÁõ¥Êé•ËøîÂõûÁöÑbooleanÂ≠óÁ¨¶‰∏≤
                        if (responseText === 'true') {
                            alert('Saved successfully');
                            bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                            location.reload();
                        } else {
                            alert('Save failed');
                        }
                    }
                } else {
                    const error = await response.json();
                    alert(error.msg || 'Save failed');
                }
            } catch (error) {
                console.error('Failed to save:', error);
                alert('Save failed, please try again');
            }
        }

        async function changeAvatar() {
            const token = getToken();
            if (!token) {
                alert('Please login first');
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    try {
                        // Á¨¨‰∏ÄÊ≠•Ôºö‰∏ä‰º†ÂõæÁâáÊñá‰ª∂
                        const uploadFormData = new FormData();
                        uploadFormData.append('file', file);
                        
                        const uploadResponse = await fetch('/image/upload', {
                            method: 'POST',
                            body: uploadFormData
                        });
                        
                        if (!uploadResponse.ok) {
                            alert('Image upload failed');
                            return;
                        }
                        
                        const responseText = await uploadResponse.text();
                        console.log('Upload response:', responseText);
                        let imageUrl;
                        try {
                            const result = JSON.parse(responseText);
                            // ÂìçÂ∫îÊ†ºÂºè: {"code":0,"msg":"success","data":"http://..."}
                            imageUrl = result.data || result;
                        } catch (e) {
                            // Â¶ÇÊûú‰∏çÊòØJSONÔºåÂèØËÉΩÊòØÁõ¥Êé•ËøîÂõûÁöÑURLÂ≠óÁ¨¶‰∏≤
                            imageUrl = responseText.trim();
                        }
                        
                        console.log('Image URL:', imageUrl);
                        
                        if (!imageUrl || imageUrl === '') {
                            alert('Failed to get image URL');
                            return;
                        }
                        
                        // Á¨¨‰∫åÊ≠•ÔºöÊõ¥Êñ∞Áî®Êà∑Â§¥ÂÉèURL
                        const updateFormData = new FormData();
                        updateFormData.append('avatar', imageUrl);
                        
                        const updateResponse = await fetch('/profile/avatar/edit', {
                            method: 'POST',
                            headers: { 'Authorization': token },
                            body: updateFormData
                        });
                        
                        console.log('Update response status:', updateResponse.status);
                        
                        if (updateResponse.ok) {
                            const updateText = await updateResponse.text();
                            console.log('Update response text:', updateText);
                            try {
                                const result = JSON.parse(updateText);
                                const success = result.data !== undefined ? result.data : result;
                                if (success) {
                                    alert('Avatar uploaded successfully');
                                    // Êõ¥Êñ∞Â§¥ÂÉèÊòæÁ§∫ÔºåÊ∑ªÂä†Êó∂Èó¥Êà≥ÈÅøÂÖçÁºìÂ≠ò
                                    const avatarImg = document.getElementById('userAvatar');
                                    if (avatarImg) {
                                        const timestamp = new Date().getTime();
                                        avatarImg.src = imageUrl + (imageUrl.includes('?') ? '&' : '?') + 't=' + timestamp;
                                    }
                                    // Âª∂ËøüÂà∑Êñ∞‰ª•Á°Æ‰øùÂ§¥ÂÉèÂ∑≤Êõ¥Êñ∞Ôºå‰ΩøÁî®ÂΩìÂâçURLÔºà‰∏çÂ∏¶userIDÂèÇÊï∞ÔºâÁ°Æ‰øùÂä†ËΩΩÂΩìÂâçÁî®Êà∑
                                    setTimeout(() => {
                                        // ÁßªÈô§URL‰∏≠ÁöÑuserIDÂèÇÊï∞ÔºåÁ°Æ‰øùÂä†ËΩΩÂΩìÂâçLoginÁî®Êà∑ÁöÑ‰ø°ÊÅØ
                                        const url = new URL(window.location.href);
                                        url.searchParams.delete('userID');
                                        window.location.href = url.toString();
                                    }, 500);
                                } else {
                                    alert('Failed to update avatar');
                                }
                            } catch (e) {
                                if (updateText === 'true' || updateText.trim() === 'true') {
                                    alert('Avatar uploaded successfully');
                                    // Êõ¥Êñ∞Â§¥ÂÉèÊòæÁ§∫ÔºåÊ∑ªÂä†Êó∂Èó¥Êà≥ÈÅøÂÖçÁºìÂ≠ò
                                    const avatarImg = document.getElementById('userAvatar');
                                    if (avatarImg) {
                                        const timestamp = new Date().getTime();
                                        avatarImg.src = imageUrl + (imageUrl.includes('?') ? '&' : '?') + 't=' + timestamp;
                                    }
                                    // Âª∂ËøüÂà∑Êñ∞‰ª•Á°Æ‰øùÂ§¥ÂÉèÂ∑≤Êõ¥Êñ∞Ôºå‰ΩøÁî®ÂΩìÂâçURLÔºà‰∏çÂ∏¶userIDÂèÇÊï∞ÔºâÁ°Æ‰øùÂä†ËΩΩÂΩìÂâçÁî®Êà∑
                                    setTimeout(() => {
                                        // ÁßªÈô§URL‰∏≠ÁöÑuserIDÂèÇÊï∞ÔºåÁ°Æ‰øùÂä†ËΩΩÂΩìÂâçLoginÁî®Êà∑ÁöÑ‰ø°ÊÅØ
                                        const url = new URL(window.location.href);
                                        url.searchParams.delete('userID');
                                        window.location.href = url.toString();
                                    }, 500);
                                } else {
                                    alert('Êõ¥Êñ∞Â§¥ÂÉèÂ§±Ë¥•: ' + updateText);
                                }
                            }
                        } else {
                            const errorText = await updateResponse.text();
                            console.error('Update error:', errorText);
                            try {
                                const error = JSON.parse(errorText);
                                alert(error.msg || 'Êõ¥Êñ∞Â§¥ÂÉèÂ§±Ë¥•');
                            } catch (e) {
                                alert('Êõ¥Êñ∞Â§¥ÂÉèÂ§±Ë¥•: ' + errorText);
                            }
                        }
                    } catch (error) {
                        console.error('Failed to upload avatar:', error);
                        alert('Upload failed, please try again');
                    }
                }
            };
            input.click();
        }

        function logout() {
            document.cookie = 'token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
            window.location.href = '/';
        }
        
        // Âä†ËΩΩÁî®Êà∑Posts
        async function loadUserPosts() {
            const userPostsDiv = document.getElementById('userPosts');
            const token = getToken();
            if (!token) {
                userPostsDiv.innerHTML = '<p class="text-muted">Please login first</p>';
                return;
            }
            
            try {
                const response = await fetch('/profile/post', {
                    headers: { 'Authorization': token }
                });
                if (response.ok) {
                    const result = await response.json();
                    console.log('loadUserPosts - API response:', result);
                    const posts = Array.isArray(result) ? result : (result.data || []);
                    console.log('loadUserPosts - Parsed posts:', posts);
                    console.log('loadUserPosts - Loaded ' + posts.length + ' posts');
                    if (posts.length > 0) {
                        console.log('loadUserPosts - First post:', posts[0]);
                    }
                    renderUserPosts(posts);
                } else {
                    const error = await response.text();
                    console.error('Failed to load posts:', response.status, error);
                    userPostsDiv.innerHTML = '<p class="text-danger">Failed to load: ' + response.status + '</p>';
                }
            } catch (error) {
                console.error('Failed to load user posts:', error);
                userPostsDiv.innerHTML = '<p class="text-danger">Failed to load: ' + error.message + '</p>';
            }
        }
        
        function renderUserPosts(posts) {
            const userPostsDiv = document.getElementById('userPosts');
            if (!posts || posts.length === 0) {
                userPostsDiv.innerHTML = '<p class="text-muted">No posts yet</p>';
                return;
            }
            
            userPostsDiv.innerHTML = posts.map(post => `
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">${post.postTitle || 'No Title'}</h5>
                        <p class="card-text">${(post.postContent || '').substring(0, 200)}${(post.postContent || '').length > 200 ? '...' : ''}</p>
                        <div class="d-flex align-items-center gap-3 mb-2">
                            <small class="text-muted">üëç ${post.postLikeAmount || 0}</small>
                            <small class="text-muted">‚≠ê ${post.postCollectAmount || 0}</small>
                            <small class="text-muted">üí¨ ${post.postCommentAmount || 0}</small>
                        </div>
                        <a href="/square/post?id=${post.postID}" class="btn btn-primary btn-sm">View Details</a>
                    </div>
                </div>
            `).join('');
        }
        
        // Âä†ËΩΩÁî®Êà∑Events
        async function loadUserEvents() {
            const userEventsDiv = document.getElementById('userEvents');
            const token = getToken();
            if (!token) {
                userEventsDiv.innerHTML = '<p class="text-muted">Please login first</p>';
                return;
            }
            
            try {
                const response = await fetch('/profile/event', {
                    headers: { 'Authorization': token }
                });
                if (response.ok) {
                    const result = await response.json();
                    const events = Array.isArray(result) ? result : (result.data || []);
                    console.log('loadUserEvents - Loaded ' + events.length + ' events');
                    renderUserEvents(events);
                } else {
                    const error = await response.text();
                    console.error('Failed to load events:', error);
                    userEventsDiv.innerHTML = '<p class="text-danger">Failed to load</p>';
                }
            } catch (error) {
                console.error('Failed to load user events:', error);
                userEventsDiv.innerHTML = '<p class="text-danger">Failed to load</p>';
            }
        }
        
        function renderUserEvents(events) {
            const userEventsDiv = document.getElementById('userEvents');
            if (!events || events.length === 0) {
                userEventsDiv.innerHTML = '<p class="text-muted">No events yet</p>';
                return;
            }
            
            userEventsDiv.innerHTML = events.map(event => {
                const eventId = event.eventId || event.id;
                const eventName = event.eventName || event.name || 'Events';
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${eventName}</h5>
                            <p class="card-text">${event.introduction || ''}</p>
                            <a href="/event?id=${eventId}" class="btn btn-primary btn-sm">View Details</a>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Âä†ËΩΩÊî∂ËóèÁöÑ Events
        async function loadFavoriteEvents() {
            const container = document.getElementById('favoriteEvents');
            const token = getToken();
            if (!token) {
                container.innerHTML = '<p class="text-muted">Please login first</p>';
                return;
            }
            try {
                const resp = await fetch('/profile/favorite/events', {
                    headers: { 'Authorization': token }
                });
                if (!resp.ok) {
                    const text = await resp.text();
                    console.error('loadFavoriteEvents error:', resp.status, text);
                    container.innerHTML = '<p class="text-danger">Failed to load favorite events</p>';
                    return;
                }
                const result = await resp.json();
                const events = Array.isArray(result) ? result : (result.data || []);
                if (!events || events.length === 0) {
                    container.innerHTML = '<p class="text-muted">No favorite events yet</p>';
                    return;
                }
                container.innerHTML = events.map(ev => {
                    const eventId = ev.eventId || ev.id;
                    const name = ev.eventName || ev.name || 'Event';
                    return `
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">${name}</h5>
                                <p class="card-text">${ev.introduction || ''}</p>
                                <a href="/event?id=${eventId}" class="btn btn-primary btn-sm">View Details</a>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('loadFavoriteEvents exception:', e);
                container.innerHTML = '<p class="text-danger">Failed to load: ' + e.message + '</p>';
            }
        }

        // Âä†ËΩΩÊî∂ËóèÁöÑ Posts
        async function loadFavoritePosts() {
            const container = document.getElementById('favoritePosts');
            const token = getToken();
            if (!token) {
                container.innerHTML = '<p class="text-muted">Please login first</p>';
                return;
            }
            try {
                const resp = await fetch('/profile/favorite/posts', {
                    headers: { 'Authorization': token }
                });
                if (!resp.ok) {
                    const text = await resp.text();
                    console.error('loadFavoritePosts error:', resp.status, text);
                    container.innerHTML = '<p class="text-danger">Failed to load favorite posts</p>';
                    return;
                }
                const result = await resp.json();
                const posts = Array.isArray(result) ? result : (result.data || []);
                if (!posts || posts.length === 0) {
                    container.innerHTML = '<p class="text-muted">No favorite posts yet</p>';
                    return;
                }
                container.innerHTML = posts.map(post => `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${post.postTitle || 'No Title'}</h5>
                            <p class="card-text">${(post.postContent || '').substring(0, 200)}${(post.postContent || '').length > 200 ? '...' : ''}</p>
                            <div class="d-flex align-items-center gap-3 mb-2">
                                <small class="text-muted">üëç ${post.postLikeAmount || 0}</small>
                                <small class="text-muted">‚≠ê ${post.postCollectAmount || 0}</small>
                                <small class="text-muted">üí¨ ${post.postCommentAmount || 0}</small>
                            </div>
                            <a href="/square/post?id=${post.postID}" class="btn btn-primary btn-sm">View Details</a>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('loadFavoritePosts exception:', e);
                container.innerHTML = '<p class="text-danger">Failed to load: ' + e.message + '</p>';
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÁªëÂÆö Tab ‰∫ã‰ª∂Âπ∂Âä†ËΩΩÈªòËÆ§Êï∞ÊçÆ
        window.addEventListener('DOMContentLoaded', function() {
            loadUserPosts();

            const postsTab = document.getElementById('posts-tab');
            const eventsTab = document.getElementById('events-tab');
            const favEventsTab = document.getElementById('fav-events-tab');
            const favPostsTab = document.getElementById('fav-posts-tab');

            if (postsTab) {
                postsTab.addEventListener('shown.bs.tab', function() {
                    loadUserPosts();
                });
            }
            if (eventsTab) {
                eventsTab.addEventListener('shown.bs.tab', function() {
                    loadUserEvents();
                });
            }
            if (favEventsTab) {
                favEventsTab.addEventListener('shown.bs.tab', function() {
                    loadFavoriteEvents();
                });
            }
            if (favPostsTab) {
                favPostsTab.addEventListener('shown.bs.tab', function() {
                    loadFavoritePosts();
                });
            }
        });
    </script>
</body>
</html>

